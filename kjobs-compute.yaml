# kjobs config for MARTI training
# Usage: kjobs submit -f kjobs-compute.yaml
#
# Before submitting, set WANDB_API_KEY in the command section or
# ensure the container image has W&B configured.
worker:
  cpu: 8
  memory: 64Gi
  gpu: 1
  image:
    repository: iad.ocir.io/ax8fanrz7l8n/post_training
  command: |
    set -e
    echo "=== MARTI Training Job ==="

    # W&B setup (set your API key)
    export WANDB_BASE_URL=https://cohere.wandb.io
    # export WANDB_API_KEY=<your-key>

    # Install minimal deps not in post_training image
    pip install wandb loguru pydantic pydantic-settings python-dotenv 2>&1 | tail -5

    # Clone the repo
    git clone https://github.com/tongt1/multiagent.git /workspace/multiagent 2>&1 | tail -3
    cd /workspace/multiagent

    # Run training with CLI args
    python -m src.training.train_marti \
      --pretrain-path HuggingFaceTB/SmolLM-135M \
      --trajectory-path data/sample_trajectories.jsonl \
      --save-path /workspace/checkpoints/marti_run_001 \
      --wandb-project marti-training \
      --wandb-run-name "marti-smolm-135m-reinforce" \
      --algorithm reinforce \
      --num-episodes 3 \
      --batch-size 8 \
      --learning-rate 1e-5

    echo "=== Training Complete ==="
  count: 1

app: marti-training
type: dynamic
