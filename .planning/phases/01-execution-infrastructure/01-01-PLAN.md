---
phase: 01-execution-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/pull_images.sh
  - scripts/setup_cooperbench.sh
autonomous: true

must_haves:
  truths:
    - "All 26 lite subset Docker images are available locally"
    - "cooperbench CLI is installed and runnable in a Python 3.12 virtualenv"
    - "Environment variables for Cohere API and staging endpoint are configured"
  artifacts:
    - path: "scripts/pull_images.sh"
      provides: "Docker image pull and verification script"
    - path: "scripts/setup_cooperbench.sh"
      provides: "cooperbench CLI installation and env var setup script"
  key_links:
    - from: "scripts/setup_cooperbench.sh"
      to: "repos/CooperBench/"
      via: "uv pip install -e editable install"
      pattern: "uv pip install -e"
    - from: "scripts/pull_images.sh"
      to: "Docker Hub akhatua/cooperbench-*"
      via: "docker pull"
      pattern: "docker pull akhatua/cooperbench"
---

<objective>
Set up the complete execution infrastructure: install the upstream CooperBench CLI in a Python 3.12 virtualenv, pull and verify all 8 missing Docker images, and configure environment variables for Cohere Command A on the staging endpoint.

Purpose: All downstream benchmark runs depend on the CLI being installed and all 26 Docker images being available. This plan gates everything else.
Output: A working `cooperbench` CLI, all 26 Docker images locally available, and environment configured for Command A.
</objective>

<execution_context>
@/home/terry_tong_cohere_com/.claude/get-shit-done/workflows/execute-plan.md
@/home/terry_tong_cohere_com/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-execution-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install cooperbench CLI and configure environment</name>
  <files>scripts/setup_cooperbench.sh</files>
  <action>
Create `scripts/setup_cooperbench.sh` that performs the following steps:

1. Create a Python 3.12 virtualenv inside `repos/CooperBench/` using `uv venv --python 3.12 .venv`
2. Activate the virtualenv and install cooperbench in editable mode: `uv pip install -e ".[dev]"`
3. Verify installation: `cooperbench --help` exits 0
4. Set up required environment variables (print them as export commands for the user to source):
   - `COHERE_API_KEY` (remind user to set this)
   - `MSWEA_MODEL_API_BASE=https://stg.api.cohere.com/v2` (staging endpoint per user decision)
   - `MSWEA_COST_TRACKING=ignore_errors` (suppress cost tracking warnings)
   - `LITELLM_LOG=ERROR` (suppress debug noise)

Then execute the script to actually install cooperbench. The working directory for cooperbench must be `repos/CooperBench/` because dataset paths are relative (`dataset/subsets/lite.json`).

**Important:** Python 3.12+ is required (system has 3.11.2). Use `uv` which is already installed at version 0.10.2.

Verify after running:
- `repos/CooperBench/.venv/bin/cooperbench --help` succeeds
- `repos/CooperBench/.venv/bin/python --version` shows 3.12+
  </action>
  <verify>
Run `repos/CooperBench/.venv/bin/cooperbench --help` and confirm it prints usage information without errors. Run `repos/CooperBench/.venv/bin/python --version` and confirm Python 3.12+.
  </verify>
  <done>
cooperbench CLI is installed in a Python 3.12 virtualenv at `repos/CooperBench/.venv/`, the CLI responds to `--help`, and environment variable export commands are documented in the setup script.
  </done>
</task>

<task type="auto">
  <name>Task 2: Pull and verify all 8 missing Docker images</name>
  <files>scripts/pull_images.sh</files>
  <action>
Create `scripts/pull_images.sh` that pulls and verifies each of the 8 missing Docker images:

```
akhatua/cooperbench-dottxt-ai-outlines:task1655
akhatua/cooperbench-dottxt-ai-outlines:task1706
akhatua/cooperbench-dspy:task8587
akhatua/cooperbench-dspy:task8635
akhatua/cooperbench-go-chi:task27
akhatua/cooperbench-llama-index:task17244
akhatua/cooperbench-react-hook-form:task85
akhatua/cooperbench-react-hook-form:task153
```

For each image:
1. `docker pull $IMAGE`
2. Start a temporary container: `docker run -d $IMAGE sleep 10`
3. Verify `/workspace` or `/workspace/repo` directory exists inside the container: `docker exec $CONTAINER test -d /workspace`
4. Remove the temporary container: `docker rm -f $CONTAINER`
5. Print pass/fail status

After all pulls, run a final verification counting total cooperbench images:
`docker images --format '{{.Repository}}:{{.Tag}}' | grep cooperbench | sort`

The script should be idempotent (re-running is safe; already-pulled images are fast no-ops).

Docker storage is already configured on the mounted disk at `/mnt/data/docker` (876GB free), so disk space is not a concern.

Then execute the script. This will take time as images may be several GB each.

**CRITICAL:** All 26 images must be present before any benchmark run can proceed (per user decision: "Block benchmark runs until all 26 lite subset images are available locally").
  </action>
  <verify>
Run `docker images --format '{{.Repository}}:{{.Tag}}' | grep cooperbench | wc -l` and confirm the count is >= 26. Run `docker images --format '{{.Repository}}:{{.Tag}}' | grep cooperbench | sort` to visually inspect that all expected images are present.
  </verify>
  <done>
All 26 lite subset Docker images are available locally (18 pre-existing + 8 newly pulled), each verified to have a `/workspace` directory inside the container.
  </done>
</task>

</tasks>

<verification>
1. `repos/CooperBench/.venv/bin/cooperbench --help` prints usage without errors
2. `repos/CooperBench/.venv/bin/python --version` shows 3.12+
3. `docker images --format '{{.Repository}}:{{.Tag}}' | grep cooperbench | wc -l` returns >= 26
4. All 8 missing images appear in `docker images` output
</verification>

<success_criteria>
- cooperbench CLI installed and operational in Python 3.12 virtualenv
- All 26 lite subset Docker images available locally and verified
- Environment variable configuration documented
</success_criteria>

<output>
After completion, create `.planning/phases/01-execution-infrastructure/01-01-SUMMARY.md`
</output>
